<div class="row margin-top-one">
    <div class="col-xs-12 col-sm-12 col-md-12">
        <div class="row margin-top-one">
            <label class="unselectable">Description</label>
        </div>
        <div class="row margin-top-quarter">
            <input class="diags-input minimal fullwidth" ng-disabled="true" ng-value="orderDescription()">
        </div>
    </div>
</div>

<div class="row margin-top-one">
    <div class="col-xs-12 col-sm-12 col-md-6">
        <div class="row margin-top-half">
            <label class="unselectable">Client</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="state.working() || item._id" type="text" class="diags-input" ng-model="item._client" placeholder="Client" uib-typeahead="client as client.email for client in getClients($viewValue) | limitTo:8" typeahead-loading="LoadingClients||'Loading clients. . .'"
            typeahead-no-results="noResults">
        </div>
        <div class="row margin-top-half">
            <label class="unselectable">Diag Man</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="state.working() || item._id" type="text" class="diags-input" ng-model="item._diag" placeholder="Diag" uib-typeahead="diag as diag.email for diag in getDiags($viewValue) | limitTo:8" typeahead-loading="LoadingDiags||'Loading diags...'"
            typeahead-no-results="noResults">
        </div>
        <div class="row margin-top-half">
            <label class="unselectable">Adresse</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="state.working() || item._id" class="diags-input" data-address model="item" field="address" city="city" department="department" region="region" country="country" post-code="postCode" type="text" placeholder="Ex: 102 rue Réaumur 75002 Paris, France">
        </div>

        <div class="row " ng-show="!item.info.house">
            <div class="col-md-4 padding-none">
                <div class="row margin-top-half">
                    <label class="unselectable">Batiment</label>
                </div>
                <div class="row margin-top-quarter">
                    <input ng-disabled="state.working() || item._id" class="diags-input sm" ng-model="item.info.addressBatiment" placeholder="Batiment">
                </div>
            </div>
            <div class="col-md-4 padding-none">
                <div class="row margin-top-half">
                    <label class="unselectable">Code</label>
                </div>
                <div class="row margin-top-quarter">
                    <input ng-disabled="state.working() || item._id" class="diags-input sm" ng-model="item.info.addressCode" placeholder="Code">
                </div>
            </div>
            <div class="col-md-4 padding-none">
                <div class="row margin-top-half">
                    <label class="unselectable">Étage</label>
                </div>
                <div class="row margin-top-quarter">
                    <input ng-disabled="state.working() || item._id" class="diags-input sm" ng-model="item.info.addressEtage" placeholder="Étage">
                </div>
            </div>
        </div>


        <div class="row margin-top-half">
            <label class="unselectable">Questions</label>
        </div>
        <div class="row margin-top-quarter" ng-show="item._id">
            <table class="table table-striped table-condensed unselectable questions">
                <tr ng-repeat="(k,o) in item.info" ng-class="{'diag-no-selected':!o,link:true}" class="unselectable" ng-show="infoItemShow(o)">
                    <td ng-bind="k"></td>
                </tr>
                <tr>
                    <td>
                        <label class="minimal">Size</label>
                        <input class="diags-input minimal" ng-value="item.info.squareMeters">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label class="minimal">Construction Date</label>
                        <input class="diags-input minimal" ng-value="item.info.constructionPermissionDate">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label class="minimal">Gaz</label>
                        <input class="diags-input minimal" ng-value="item.info.gasInstallation">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label class="minimal">Electricity</label>
                        <input class="diags-input minimal" ng-value="item.info.electricityInstallation">
                    </td>
                </tr>
            </table>
        </div>
        <div class="row margin-top-quarter" ng-show="!item._id">
            <table class="table table-striped table-condensed unselectable questions">
                <tr ng-repeat="(k,o) in item.info" class="unselectable" ng-show="infoItemShow(o)">
                    <td ng-bind="k" ng-class="{'diag-no-selected':!o,link:true}" ng-click=item.info[k]=!item.info[k]></td>
                </tr>
                <tr class="unselectable">
                    <td>
                        <label class="minimal">Size</label>
                        <select class="diags-input minimal" ng-model="item.info.squareMeters" ng-options="item as item for item in squareMeters">
                            <option value="">Select</option>
                        </select>
                    </td>
                </tr>
                <tr class="unselectable">
                    <td>
                        <label class="minimal">Construction Date</label>
                        <select class="diags-input minimal" ng-model="item.info.constructionPermissionDate" ng-options="item as item for item in constructionPermissionDate">
                            <option value="">Select</option>
                        </select>
                    </td>
                </tr>
                <tr class="unselectable">
                    <td>
                        <label class="minimal">Gaz</label>
                        <select class="diags-input minimal" ng-model="item.info.gasInstallation" ng-options="item as item for item in gasInstallation">
                            <option value="">Select</option>
                        </select>
                    </td>
                </tr>
                <tr class="unselectable">
                    <td>
                        <label class="minimal">Electricity</label>
                        <select class="diags-input minimal" ng-model="item.info.electricityInstallation" ng-options="item as item for item in electricityInstallation">
                            <option value="">Select</option>
                        </select>
                    </td>
                </tr>
            </table>
        </div>

        <div class="row margin-top-half">
            <label class="unselectable">Liste diags</label>
        </div>
        <div class="row margin-top-quarter" ng-show="item._id">
            <table class="table table-striped table-condensed unselectable">
                <tr ng-repeat="(k,o) in item.diags" class="unselectable" ng-show="o">
                    <td ng-bind="diagNameConvertion(k)"></td>
                </tr>
            </table>
        </div>
        <div class="row margin-top-quarter" ng-show="!item._id">
            <table class="table table-striped table-condensed unselectable">
                <tr ng-repeat="(k,o) in item.diags" class="unselectable">
                    <td ng-bind="k" ng-class="{'diag-no-selected':!o,link:true}" ng-click=item.diags[k]=!item.diags[k]></td>
                </tr>
            </table>
        </div>
        <div class="row margin-top-half" ng-show="!item._id">
            <label class="unselectable">Date rules</label>
        </div>
        <div class="" ng-show="!item._id">
            <input type="text" class="diags-input" disabled ng-value="totalTimeFormated()" />
        </div>
        <div class="" ng-show="!item._id">
            <button class="btn btn-default" ng-disabled="isPaid()" ng-click="applyTotalTime()">Apply</button>
        </div>
        <div class="row margin-top-half">
            <label class="unselectable">Date du diagnostic</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="true" class="diags-input" ng-value="momentDateTime(item.start)" placeholder="Start">
        </div>
        <div class="row margin-top-quarter relative" ng-if="false">
            <input ng-show="item._id" ng-disabled="true" class="diags-input" ng-value="momentDateTime(item.start)" placeholder="Adresse">
            <input ng-show="!item._id" ng-disabled="isPaid() || state.working() || is(['client','diag'])" type="text" class="max-w-150 diags-input" datetime-picker="dd/MM/yyyy HH:mm " ng-model="item.start" min-date="datepicker.minDate" max-date="datepicker.maxDate"
            init-date="item.start" ng-init="start.opened=false" is-open="start.opened" date-disabled="false" close-text="Close" />
            <button ng-show="!item._id" ng-disabled="state.working() || is(['client','diag'])" type="button" class="btn diags-btn" ng-click="start.opened = !start.opened"><i class="glyphicon glyphicon-calendar"></i></button>
        </div>
        <div class="row margin-top-half">
            <label class="unselectable">Date end</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="true" class="diags-input" ng-value="momentDateTime(item.end)" placeholder="End">
        </div>

        <div class="row margin-top-one" ng-show="!item._id">
            <label>Price Rules</label>
            <table class="table minimal">
                <thead>
                    <tr>
                        <th></th>
                        <th>+</th>
                        <th>-</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td ng-bind="'Base price'"></td>
                        <td ng-bind="__priceQuote.basePrice"></td>
                        <td></td>
                    </tr>
                    <tr ng-repeat="(name,price) in __priceQuote.diags">
                        <td ng-bind="name"></td>
                        <td ng-bind="price"></td>
                        <td></td>
                    </tr>

                </tbody>
                <tfoot>
                    <tr>
                        <td ng-bind="'Diags price '"></td>
                        <td ng-bind="__priceQuote.selectedDiagsTotalPrice"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'Subtotal'"></td>
                        <td ng-bind="__priceQuote.subTotal"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'Extra Building Price '+__priceQuote.extraBuildingSizePorc+'%'"></td>
                        <td ng-bind="__priceQuote.extraBuildingSizePrice"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'Extra Date Price '+__priceQuote.extraDatePriceType+' '+__priceQuote.extraDatePricePorc+'%'"></td>
                        <td ng-bind="__priceQuote.extraDatePrice"></td>
                        <td></td>
                    </tr>

                    <tr>
                        <td ng-bind="'Discount Client '+__priceQuote.discountClientPorc+'%'"></td>
                        <td></td>
                        <td ng-bind="__priceQuote.discountClientPrice"></td>
                    </tr>
                    <tr>
                        <td ng-bind="'Total raw'"></td>
                        <td ng-bind="__priceQuote.total"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'Difference (tenth  10)'"></td>
                        <td></td>
                        <td ng-bind="__priceQuote.totalRoundedValue"></td>
                    </tr>
                    <tr>
                        <td ng-bind="'TotalHT'"></td>
                        <td ng-bind="__priceQuote.totalRoundedHT"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'VAT '+__priceQuote.vatRate+'%'"></td>
                        <td ng-bind="__priceQuote.vatPrice"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'TotalTTC (For Client)'"></td>
                        <td ng-bind="__priceQuote.totalRoundedTTC"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'RemunerationHT '+__priceQuote.diagCommissionRate+'%'"></td>
                        <td ng-bind="__priceQuote.diagRemunerationHT"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td ng-bind="'RevenueHT '+__priceQuote.revenueRate+'%'"></td>
                        <td ng-bind="__priceQuote.revenueHT"></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
            <!--
            <button class="btn btn-default" ng-disabled="isPaid()" ng-click="applyTotalPrice()">Calculate</button>
            -->
        </div>

    </div>
    <div class="col-xs-12 col-sm-12 col-md-6 ">
        <div class="row margin-top-half" ng-show="isOrderClientAgency()">
            <label class="unselectable">Propriétaire</label>
        </div>
        <div class="row margin-top-quarter" ng-show="isOrderClientAgency()">
            <input ng-disabled="state.working()" class="diags-input" ng-model="item.landLordFullName" placeholder="Propriétaire">
        </div>
        <div class="row margin-top-quarter" ng-show="isOrderClientAgency()">
            <input ng-disabled="state.working()" class="diags-input" ng-model="item.landLordEmail" placeholder="Propriétaire Email">
        </div>
        <div class="row margin-top-quarter" ng-show="isOrderClientAgency()">
            <input ng-disabled="state.working()" class="diags-input" ng-model="item.landLordPhone" placeholder="Propriétaire Phone">
        </div>
        <div class="row margin-top-quarter" ng-show="isOrderClientAgency()">
            <input ng-disabled="state.working()" class="diags-input" data-address model="item" field="landLordAddress" placeholder="Propriétaire Adresse">
        </div>
        <div class="row margin-top-half">
            <label class="unselectable">Observations</label>
        </div>
        <div class="row margin-top-quarter">
            <textarea ng-disabled="state.working()" class="diags-input fullwidth min-height-100 no-resize" ng-model="item.obs"></textarea>
        </div>
        <div class="row margin-top-one">
                <div ng-include="'views/diags/backoffice/partials/order-details-pdf-files.html'" includeReplace></div>
            </div>
        

        <div class="row margin-top-half">
            <label class="unselectable">Remise des clés</label>
        </div>
        <div class="row margin-top-one" ng-show="true">
            <!-- KEYS WHERE -->
            <div class="dropdown with-caret">
                <button class="btn btn-default diags-input dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <span>{{__keysWhereSelectLabel()}}</span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu diags-select" aria-labelledby="dropdownMenu1">
                    <li ng-repeat="(k,v) in __keysWhereItems">
                        <a class="link" ng-click="__keysWhereSelect(k,v)">{{k}}</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="row margin-top-half">
            <input ng-disabled="item.keysWhere!=='other'" data-address model="item" field="keysAddress" class="diags-input" placeholder="Adresse">
        </div>
        <div class="row margin-top-half">

            <!-- KEYS TIME FROM -->
            <div class="dropdown with-caret">
                <button ng-disabled="state.working() || item._id" class="btn btn-default diags-input half dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <span>{{__keysTimeFromSelectLabel}}</span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu diags-select" aria-labelledby="dropdownMenu1">
                    <li ng-repeat="(k,v) in __keysTimeFromItems">
                        <a class="link" ng-click="__keysTimeFromSelect(k,v)">{{k}}</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="row margin-top-half">
            <!-- KEYS TIME TO -->
            <div class="dropdown with-caret">
                <button ng-disabled="state.working() || item._id" class="btn btn-default diags-input half dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <span>{{__keysTimeToSelectLabel}}</span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu diags-select" aria-labelledby="dropdownMenu1">
                    <li ng-repeat="(k,v) in __keysTimeToItems">
                        <a class="link" ng-click="__keysTimeToSelect(k,v)">{{k}}</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="row margin-top-half" ng-show="!item._id">
            <label class="unselectable">RDV</label>
        </div>
        <div class="row margin-top-quarter">
            <out ng-show="!rdvConditions()">
                <div ng-show="!item.info.squareMeters" class="alert alert-info" role="alert">Answer question size.</div>
                <div ng-show="!item._client" class="alert alert-info" role="alert">Choice a client.</div>
            </out>
            <out ng-show="rdvConditions()">
                <div ng-include="'views/diags/backoffice/admin/admin-order-details-slots.html'" includeReplace></div>
            </out>
        </div>


    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-6 ">

        <div class="row margin-top-one">
            <label class="unselectable">Prix TTC</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="true" type="text" class="diags-input" ng-model="item.price">
        </div>
        <div class="row margin-top-one">
            <label class="unselectable">PriceHT</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="true" type="text" class="diags-input" ng-model="item.priceHT">
        </div>
        <div class="row margin-top-one">
            <label class="unselectable">RumunerationHT</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="true" type="text" class="diags-input" ng-model="item.diagRemunerationHT">
        </div>
        <div class="row margin-top-one">
            <label class="unselectable">RevenueHT</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="true" type="text" class="diags-input" ng-model="item.revenueHT">
        </div>
        <div class="row margin-top-half">
            <label class="unselectable">Statut</label>
        </div>
        <div class="row margin-top-quarter">
            <input ng-disabled="true" type="text" class="diags-input" ng-value="item.status">
        </div>
    </div>
</div>
<div class="row margin-top-one" ng-show="item.status=='created'">
    <div class="alert alert-info" role="alert">Admin note:
        <br> An order with the status created means that it was created successfuly using the booking system
        <br> but it was not paid or delegated.</div>
</div>
<div class="row margin-top-one" ng-show="item.status=='ordered'">
    <div class="alert alert-info" role="alert">Admin note:
        <br> An order with the status ordered means that it was created successfuly using the booking system
        <br> and it was delegated to a landlord.</div>
</div>
<div class="row margin-top-one" ng-show="item.status=='prepaid'">
    <div class="alert alert-info" role="alert">Admin note:
        <br> An order with the status prepaid means that it was paid successfuly no metter how and the diag pdf is pending.</div>
</div>
<div class="row margin-top-one" ng-show="item.status=='delivered'">
    <div class="alert alert-info" role="alert">Admin note:
        <br> An order with the status delivered means that the diag pdf is uploaded but the payment is pending.</div>
</div>
<div class="row margin-top-one ">
    <div class="col-sm-12 diags-crud-buttons-col">
        <button ng-click="validate()" ng-disabled="state.working()" class="btn diags-btn bg-madison margin-top-quarter">Enregistrer</button>

        <button ng-show="!isPaid() && isOrderClientAgency()" ng-click="delegate()" ng-disabled="state.working()" class="btn diags-btn bg-madison margin-top-quarter">Delegate</button>

        <button ng-show="item._id && item.status!=='prepaid' && item.status !=='completed'" ng-click="pay()" ng-disabled="state.working()" class="btn diags-btn bg-blaze-orange margin-top-quarter">Pay</button>

        <button ng-click="viewPDF()" ng-disabled="state.working() || !item._id" class="btn diags-btn bg-azure-radiance margin-top-quarter">Invoice PDF</button>

        <button ng-click="cancel()" ng-disabled="state.working()" class="btn diags-btn bg-azure-radiance margin-top-quarter">Annuler</button>
        <button ng-click="delete()" ng-disabled="state.working() || !item._id" class="btn diags-btn bg-azure-radiance margin-top-quarter">Supprimer</button>


    </div>
</div>
